--Pre-made areas

--Waves
AREA_SHORTWAVE3 = {
    {1, 1, 1},
    {1, 1, 1},
    {0, 3, 0}
    }
    
    AREA_WAVE10 = {
    {1, 1, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 0, 3, 0, 0, 0}
    }
    
    AREA_WAVE11 = {
    {1, 1, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 0, 1, 0, 0, 0},
    {0, 0, 0, 3, 0, 0, 0}
    }
    
    AREA_WAVE12 = {
    {0, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 0, 1, 0, 0, 0},
    {0, 0, 0, 3, 0, 0, 0}
    }
    
    AREA_WAVE13 = {
    {1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 0, 0},
    {0, 0, 0, 1, 0, 0, 0},
    {0, 0, 0, 3, 0, 0, 0}
    }
    
    AREA_WAVE4 = {
    {1, 1, 1, 1, 1},
    {0, 1, 1, 1, 0},
    {0, 1, 1, 1, 0},
    {0, 0, 3, 0, 0}
    }
    
    AREA_WAVE5 = {
    {1, 1, 1, 1, 1},
    {0, 1, 1, 1, 0},
    {0, 1, 1, 1, 0},
    {0, 1, 1, 1, 0},
    {0, 0, 1, 0, 0},
    {0, 0, 3, 0, 0}
    }
    
    AREA_WAVE6 = {
    {0, 0, 0, 0, 0},
    {0, 1, 3, 1, 0},
    {0, 0, 0, 0, 0}
    }
    
    AREA_WAVE7 = {
    {1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1},
    {0, 1, 1, 1, 0},
    {0, 1, 1, 1, 0},
    {0, 0, 3, 0, 0}
    }
    
    AREA_SQUAREWAVE5 = {
    {1, 1, 1},
    {1, 1, 1},
    {1, 1, 1},
    {0, 1, 0},
    {0, 3, 0}
    }
    
    AREA_SQUAREWAVE6 = {
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0}
    }
    
    AREA_SQUAREWAVE7 = {
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0}
    }
    
    --Diagonal waves
    AREADIAGONAL_WAVE4 = {
    {0, 0, 0, 0, 1, 0},
    {0, 0, 0, 1, 1, 0},
    {0, 0, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 0},
    {1, 1, 1, 1, 1, 0},
    {0, 0, 0, 0, 0, 3}
    }
    
    AREADIAGONAL_SQUAREWAVE5 = {
    {1, 1, 1, 0, 0},
    {1, 1, 1, 0, 0},
    {1, 1, 1, 0, 0},
    {0, 0, 0, 1, 0},
    {0, 0, 0, 0, 3}
    }
    
    AREADIAGONAL_WAVE6 = {
    {0, 0, 1},
    {0, 3, 0},
    {1, 0, 0}
    }
    
    AREADIAGONAL_WAVE7 = {
    {0, 0, 0, 0, 0, 1, 0},
    {0, 0, 0, 0, 1, 1, 0},
    {0, 0, 0, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 0},
    {1, 1, 1, 1, 1, 1, 0},
    {0, 0, 0, 0, 0, 0, 3}
    }
    
    --Beams
    AREA_BEAM1 = {
    {3}
    }
    
    AREA_BEAM5 = {
    {1},
    {1},
    {1},
    {1},
    {3}
    }
    
    AREA_BEAM7 = {
    {1},
    {1},
    {1},
    {1},
    {1},
    {1},
    {3}
    }
    
    AREA_BEAM8 = {
    {1},
    {1},
    {1},
    {1},
    {1},
    {1},
    {1},
    {3}
    }
    
    --Diagonal Beams
    AREADIAGONAL_BEAM5 = {
    {1, 0, 0, 0, 0},
    {0, 1, 0, 0, 0},
    {0, 0, 1, 0, 0},
    {0, 0, 0, 1, 0},
    {0, 0, 0, 0, 3}
    }
    
    AREADIAGONAL_BEAM7 = {
    {1, 0, 0, 0, 0, 0, 0},
    {0, 1, 0, 0, 0, 0, 0},
    {0, 0, 1, 0, 0, 0, 0},
    {0, 0, 0, 1, 0, 0, 0},
    {0, 0, 0, 0, 1, 0, 0},
    {0, 0, 0, 0, 0, 1, 0},
    {0, 0, 0, 0, 0, 0, 3}
    }
    
    --Circles
    AREA_CIRCLE2X2 = {
    {0, 1, 1, 1, 0},
    {1, 1, 1, 1, 1},
    {1, 1, 3, 1, 1},
    {1, 1, 1, 1, 1},
    {0, 1, 1, 1, 0}
    }
    
    AREA_CIRCLE3X3 = {
    {0, 0, 1, 1, 1, 0, 0},
    {0, 1, 1, 1, 1, 1, 0},
    {1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 3, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 0, 0}
    }
    
    AREA_CIRCLE3X32 = {
    {1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 3, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1}
    }
    
    AREA_CIRCLE3X33 = {
    {1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1},
    {1, 1, 0, 0, 1, 1, 1},
    {1, 1, 0, 3, 1, 1, 1},
    {1, 1, 0, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1}
    }
    
    -- Crosses
    AREA_CIRCLE1X1 = {
    {0, 1, 0},
    {1, 3, 1},
    {0, 1, 0}
    }
    
    AREA_CIRCLE5X5 = {
    {0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {1, 1, 1, 1, 1, 3, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0}
    }
    
    AREA_CIRCLE5X5V2 = {
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 3, 1, 1, 1, 1, 0},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
    }
    
    AREA_CIRCLE6X6 = {
    {0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {1, 1, 1, 1, 1, 1, 3, 1, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
    {0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0}
    }
    
    --Squares
    AREA_SQUARE1X1 = {
    {1, 1, 1},
    {1, 3, 1},
    {1, 1, 1}
    }
    
    -- Walls
    AREA_WALLFIELD = {
    {1, 1, 3, 1, 1}
    }
    
    AREADIAGONAL_WALLFIELD = {
    {0, 0, 0, 0, 1},
    {0, 0, 0, 1, 1},
    {0, 1, 3, 1, 0},
    {1, 1, 0, 0, 0},
    {1, 0, 0, 0, 0},
    }
    
    -- Walls Energy
    AREA_WALLFIELD_ENERGY = {
    {1, 1, 1, 3, 1, 1, 1}
    }
    
    AREADIAGONAL_WALLFIELD_ENERGY = {
    {0, 0, 0, 0, 0, 0, 1},
    {0, 0, 0, 0, 0, 1, 1},
    {0, 0, 0, 0, 1, 1, 0},
    {0, 0, 1, 3, 1, 0, 0},
    {0, 1, 1, 0, 0, 0, 0},
    {0, 1, 0, 0, 0, 0, 0},
    {1, 0, 0, 0, 0, 0, 0},
    }
    
    -- Spells-only arrays
    
    --This HUGE array contains all corpses of the game, until protocol 8.0
    -- It is used on animate dead rune and on undead legion spell. No unmoveable corpses are there.
    CORPSES = {
    3987,3988,3989,3990,4252,864,395,3994,3995,3996,3996,3998,3999,4000,4001,4002,4003,4004,
    4005,4006,4007,4008,4009,4009,4011,4012,4013,4275,4276,4016,4017,4018,4280,4020,4021,4022,
    4022,4024,4025,4026,4027,4064,4029,4030,4031,4032,4032,4034,4296,4036,4036,4038,4039,4040,
    427,168,4062,4063,4064,4289,4066,4067,4068,4069,4070,4071,4072,4072,4074,4075,4076,4076,
    4078,4079,4080,4081,4082,4083,4084,4085,4086,4087,4088,4089,4090,4091,4092,4093,4094,4095,
    4096,4097,4098,4099,4099,4101,4102,4103,4104,4105,4106,4107,4108,4109,4110,3992,4112,4113,
    4114,4114,4116,4117,4118,4119,4120,4121,4122,4123,4123,4125,4126,4127,4128,4129,4130,4131,
    4132,4133,4134,4135,4136,4137,4138,4139,4139,4141,4142,4143,4143,4145,4146,4147,4148,4149,
    4150,4151,4152,4153,4154,4155,4156,4157,4158,4159,4160,4161,4162,4163,4164,4165,4166,4167,
    4168,4169,4170,4171,4172,4173,4302,4175,4176,4177,4111,4179,4180,3000,4182,4183,4184,4185,
    4186,4187,4188,4189,4190,4191,4192,4193,4194,4195,4196,4197,4198,4199,4200,4201,4202,4203,
    4204,4205,4206,4207,4208,4209,4210,4211,4212,4213,4214,4215,4216,4217,4218,4219,4220,4221,
    4222,4223,4224,4225,4226,4227,4228,4229,4230,4231,4232,4233,4234,4235,4236,4237,4238,4240,
    4241,4242,4243,4244,4245,4246,4247,4248,4249,4250,4251,4252,4178,4253,4255,4256,4257,4258,
    4259,4260,4261,4262,4263,4264,4265,4266,4267,4268,4269,4270,4271,4272,4273,4274,4275,4276,
    4277,4278,4279,4280,4281,4282,4283,4284,4285,4286,4287,4288,4289,4290,4291,4292,4293,4294,
    4295,4296,4297,4298,4299,4300,4301,4302,4303,4311,4312,4313,4314,4315,4316,4317,4310,4318,
    4319,4320,4321,4322,4323,4324,4325,4326,4327,4328,4329,4330,4331,4332,4333,4334,4335,4336,
    4337,4338,4339,4340,4341,4342,4343,4344,4345,4346,4347,4348,4349,4350,4351,4352,4353,4354,
    4355,4356,4357,4358,4359,4360,4361,4362,4363,4364,4365,4366,4367,4368,4369,4370,4371,4372,
    4373,4374,4375,4376,4377,4378,4379,4380,4381,4382,4383,4384,4385,4386,4387,4388,4389,4390,
    4391,4392,5521,5522,5523,5524,5525,5526,5527,5528,5529,5530,5531,5532,5533,5534,5535,5536,
    5537,5539,5540,5541,5564,5565,5566,5567,5624,5625,5626,5627,5628,5629,5665,5666,5667,5688,
    5689,5690,5727,5728,5729,5762,5765,5766,5767,5931,5932,5933,5934,5935,5936,5965,6022,6082,
    6083,6084,6302,6303,6304,6306,6307,6308,6309,6312,6313,6314,6316,6317,6318,6320,6321,6322,
    6324,6325,6326,6327,6328,6329,6332,6333,6334,6336,6337,6338,6340,6341,6342,6344,6345,6346,
    6348,6349,6350,6354,6364,6365,6366,6519,6520,6521,6560,7092,7093,7094,7256,7257,7258,7283,
    7284,7285,7317,7318,7319,7321,7322,7323,7325,7326,7328,7329,7331,7332,7333,7335,7336,7337,
    7339,7340,7341,7345,7346,7347,271,272,273,274,275,277,278,279,287,288,289,657,
    658,659,772,773,835,862,863,4254,866,910,911,7538}
    
    -- This array contains all destroyable field items
    FIELDS = {2118,2119,2120,105,2122,2123,2124,2125,2126,2121,21465,2132,2133,2134,2135}
    
    -- The numbered-keys represents the damage values, and their table
    -- contains the minimum and maximum number of rounds of those damage values.
    RANGE = {
    [1]  = {19, 20}, [2]  = {10, 10}, [3]  = {6, 7}, [4]  = {4, 5}, [5]  = {3, 4},
    [6]  = {3, 4},   [7]  = {2, 3},   [8]  = {2, 3}, [9]  = {2, 3}, [10] = {1, 2},
    [11] = {1, 2},   [12] = {1, 2},   [13] = {1, 2}, [14] = {1, 2}, [15] = {1, 2},
    [16] = {1, 2},   [17] = {1, 2},   [18] = {1, 2}, [19] = {1, 2}
    }
    
    function Creature:addDamageCondition(target, conditionType, listType, damage, time, rounds)
        if target:isImmune(conditionType) then
            return false
        end
    
        local condition = Condition(conditionType)
        condition:setParameter(CONDITION_PARAM_OWNER, self:getId())
        condition:setParameter(CONDITION_PARAM_DELAYED, true)
    
        if listType == 0 then
            local exponent, value = -10, 0
            while value < damage do
                value = math.floor(10 * math.pow(1.2, exponent) + 0.5)
                condition:addDamage(1, time or 4000, -value)
    
                if value >= damage then
                    local permille = math.random(10, 1200) / 1000
                    condition:addDamage(1, time or 4000, -math.max(1, math.floor(value * permille + 0.5)))
                else
                    exponent = exponent + 1
                end
            end
        elseif listType == 1 then
            rounds = rounds or RANGE
            if rounds[damage] then
                condition:addDamage(math.random(1, rounds[damage][2]), time or 4000, -damage)
                damage = damage - 1
            end
    
            while damage > 0 do
                condition:addDamage(rounds[damage] and math.random(rounds[damage][1], rounds[damage][2]) or 1, time or 4000, -damage)
                damage = damage - (damage > 21 and math.floor(damage / 20) + math.random(0, 1) or 1)
            end
        elseif listType == 2 then
            for _ = 1, rounds do
                condition:addDamage(1, math.random(time[1], time[2]) * 1000, -damage)
            end
        end
    
        target:addCondition(condition)
        return true
    end
    
    function Player:addPartyCondition(combat, variant, condition, baseMana)
        local party = self:getParty()
        if not party then
            self:sendCancelMessage(RETURNVALUE_NOPARTYMEMBERSINRANGE)
            self:getPosition():sendMagicEffect(CONST_ME_POFF)
            return false
        end
    
        local members = party:getMembers()
        members[#members + 1] = party:getLeader()
    
        local position = self:getPosition()
        local affectedMembers = {}
        for _, member in ipairs(members) do
            if member:getPosition():getDistance(position) <= 36 then
                affectedMembers[#affectedMembers + 1] = member
            end
        end
    
        if #affectedMembers <= 1 then
            self:sendCancelMessage(RETURNVALUE_NOPARTYMEMBERSINRANGE)
            position:sendMagicEffect(CONST_ME_POFF)
            return false
        end
    
        local mana = math.ceil(math.pow(0.9, #affectedMembers - 1) * baseMana * #affectedMembers)
        if self:getMana() < mana then
            self:sendCancelMessage(RETURNVALUE_NOTENOUGHMANA)
            position:sendMagicEffect(CONST_ME_POFF)
            return false
        end
    
        if not combat:execute(self, variant) then
            self:sendCancelMessage(RETURNVALUE_NOTPOSSIBLE)
            position:sendMagicEffect(CONST_ME_POFF)
            return false
        end
    
        self:addMana(baseMana - mana, false)
        self:addManaSpent(mana - baseMana)
    
        for _, member in ipairs(affectedMembers) do
            member:addCondition(condition)
        end
        return true
    end
    
    function Player:conjureItem(reagentId, conjureId, conjureCount, effect)
        if not conjureCount and conjureId ~= 0 then
            local itemType = ItemType(conjureId)
            if itemType:getId() == 0 then
                return false
            end
    
            local charges = itemType:getCharges()
            if charges ~= 0 then
                conjureCount = charges
            end
        end
    
        if reagentId ~= 0 and not self:removeItem(reagentId, 1, -1) then
            self:sendCancelMessage(RETURNVALUE_YOUNEEDAMAGICITEMTOCASTSPELL)
            self:getPosition():sendMagicEffect(CONST_ME_POFF)
            return false
        end
    
        local item = self:addItem(conjureId, conjureCount)
        if not item then
            self:sendCancelMessage(RETURNVALUE_NOTPOSSIBLE)
            self:getPosition():sendMagicEffect(CONST_ME_POFF)
            return false
        end
    
        if item:hasAttribute(ITEM_ATTRIBUTE_DURATION) then
            item:decay()
        end
    
        self:getPosition():sendMagicEffect(item:getType():isRune() and CONST_ME_MAGIC_RED or effect)
        return true
    end
    